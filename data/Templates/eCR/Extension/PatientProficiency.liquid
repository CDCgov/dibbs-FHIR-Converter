{% if modeCode != nil or proficiencyLevelCode != nil %}
{% assign modeCodeDisplay = modeCode.code | downcase | get_property: 'ValueSet/LanguageAbilityMode', 'display' -%}
{% assign proficiencyLevelCodeDisplay = proficiencyLevelCode.code | downcase | get_property: 'ValueSet/LanguageAbilityProficiency', 'display' -%}

{% if modeCodeDisplay != blank and modeCodeDisplay != nil %}
    {% assign hasModeCodeDisplay = true %}
{% endif -%}
{% if proficiencyLevelCodeDisplay != blank and proficiencyLevelCodeDisplay != nil %}
    {% assign hasProficiencyLevelCodeDisplay = true %}
{% endif -%}

{% if hasModeCodeDisplay or hasProficiencyLevelCodeDisplay %}
"url": "http://hl7.org/fhir/StructureDefinition/patient-proficiency",
"extension": 
[
    {% if hasModeCodeDisplay %}
    {
        "url": "type",
        "valueCoding": 
        {
            "system": "http://terminology.hl7.org/CodeSystem/v3-LanguageAbilityMode",
            "code": "{{ modeCode.code | upcase }}",
            "display": "{{ modeCodeDisplay }}",        
        },
    },
    {% endif -%}
    {% if hasProficiencyLevelCodeDisplay %}
    {
        "url": "level",
        "valueCoding": 
        {
            "system": "http://terminology.hl7.org/CodeSystem/v3-LanguageAbilityProficiency",
            "code": "{{ proficiencyLevelCode.code | upcase }}",
            "display": "{{ proficiencyLevelCodeDisplay }}",        
        },
    },
    {% endif -%}
],
{% endif -%}
{% endif -%}