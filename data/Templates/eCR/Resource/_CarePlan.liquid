{
    "fullUrl":"urn:uuid:{{ID}}",
    "resource":{
        "resourceType": "CarePlan",
        "id":"{{ID}}",
        "identifier":
        [
            {% assign ids = carePlan.id | to_array -%}
            {% for id in ids -%}
                { {% include 'DataType/Identifier' Identifier: id -%} }
            {% endfor -%}
        ],
        "status": "unknown",
        "intent": "proposal",
        "subject": {
            "reference": "{{ patientReference }}",
        },
        "activity":[
            {% for entry in carePlan.entry %}
                {% if entry.act %}
                    {
                        "detail": {
                            {% if entry.act.moodCode == "ARQ" or entry.act.moodCode == "APT" %}
                                "kind": "Appointment",
                            {% else %}
                                "kind": "Task",
                            {% endif %}
                            "code": { {% include 'DataType/CodeableConcept' CodeableConcept: entry.act.code %} },
                            {% assign reasons = entr.act.entryRelationship | where: "typeCode", "RSON" %}
                            "reasonCode": [
                                {% for reason in reasons %}
                                    { {% include 'DataType/CodeableConcept' CodeableConcept: reason.observation.value %} },
                                {% endfor %}
                            ],
                            {% if entry.act.effectiveTime %}
                                "status": "scheduled",
                            {% else %}
                                "status": "not-started",
                            {% endif %}
                            {% include 'Utils/EffectiveTime' effectiveTime: entry.act.effectiveTime, timeType: "scheduled" %}
                        }
                    }
                {% endif %}
            {% endfor %}
            {% comment %} {% for carePlanEntry in carePlan.entry %}
                {% if carePlanEntry.procedure.templateId.root == "2.16.840.1.113883.10.20.22.4.41" or carePlanEntry.procedure.templateId[0].root == "2.16.840.1.113883.10.20.22.4.41" %}
                {
                    "detail": {
                        "code":{ {% include 'DataType/CodeableConcept' CodeableConcept: carePlanEntry.procedure.code -%} },
                        "status":"scheduled",
                        "scheduledString": "{{ carePlanEntry.procedure.effectiveTime.value }}",
                    },
                    "extension": [
                        {
                            "url": "dibbs.orderedDate",
                            "valueString": "{{ carePlanEntry.procedure.author.time.value }}"
                        }
                    ]
                },
                {% endif %}
            {% endfor %} {% endcomment %}
        ]
    },
    "request":{
        "method":"PUT",
        "url":"CarePlan/{{ID}}",
    },
},
