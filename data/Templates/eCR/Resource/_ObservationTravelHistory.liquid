{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Observation",
        "id":"{{ ID }}",
        "meta":
        {
            "profile":
            [
                "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-travel-history",
            ],
        },
        "code" : {
            "coding" :
            [
                {
                    "system" : "http://snomed.info/sct",
                    "code" : "420008001",
                    "display" : "Travel"
                }
            ],
            "text" : "Travel History"
        },
        "status":
             {% if observationEntry.statusCode._ -%}
                "{{ observationEntry.statusCode._}}",
            {% else -%}
                "{{ observationEntry.statusCode.code | get_property: 'ValueSet/ObservationStatus' }}",
            {% endif -%}
        {% include 'Utils/EffectiveTime' effectiveTime: observationEntry.effectiveTime %}
        "component":
        [
            {% assign locs = observationEntry.participant | to_array | where: "typeCode", "LOC" %}
            {% for loc in locs %}
                {
                    "code" : {
                        "coding" :
                        [
                            {
                                "system" : "http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                "code" : "LOC",
                                "display" : "Location"
                            }
                        ]
                    },
                    {% if loc.participantRole.code %}
                        {% include 'Utils/ValueHelper' value: loc.participantRole.code %}
                    {% endif %}
                    {% if loc.participantRole.addr %}
                        "extension": [
                            {
                                "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-address-extension",
                                "valueAddress": {
                                    {% include 'DataType/Address' Address: loc.participantRole.addr %}
                                },
                            },
                        ],
                    {% endif %}
                },
            {% endfor %}
            {% capture entryText -%}
                {%- include 'Utils/TextHelper' text: observationEntry.text, origText: socialHistoryText -%}
            {%- endcapture %}
            {% if entryText and entryText != '' %}
                 {
                    "code" : {
                        "coding" :
                        [
                            {
                                "system" : "http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                "code" : "LOC",
                                "display" : "Location"
                            }
                        ]
                    },
                    "valueCodeableConcept" : {
                        "text": "{{ entryText }}",
                    },
                 },
            {% endif %}
            
            {% assign rels = observationEntry.entryRelationship | to_array %}
            {% for rel in rels %}
                {% if rel.observation.templateId.root == '2.16.840.1.113883.10.20.15.2.3.51' %}
                    {
                        "code" : {
                            "coding" :
                            [
                                {
                                    "system" : "http://snomed.info/sct",
                                    "code" : "280147009",
                                    "display" : "Travel Purpose"
                                }
                            ]
                        },
                        {% include 'Utils/ValueHelper' value: rel.observation.value %}
                    },
                {% endif %}
            {% endfor %}
        ],
    },
    "request":{
        "method":"PUT",
        "url":"Observation/{{ ID }}",
    },
},
