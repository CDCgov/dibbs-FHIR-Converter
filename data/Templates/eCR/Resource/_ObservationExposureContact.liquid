{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Observation",
        "id":"{{ ID }}",
        "meta":
        {
            "profile":
            [
                "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-exposure-contact-information",
            ],
        },
        "identifier":
        [
            {% assign ids = observationEntry.id | to_array -%}
            {% for id in ids -%}
            { {% include 'DataType/Identifier' Identifier: id -%} },
            {% endfor -%}
        ],
        "code" : {
            {% include 'DataType/CodeableConcept' CodeableConcept: observationEntry.code %}
        },
        "status":
             {% if observationEntry.statusCode._ -%}
                "{{ observationEntry.statusCode._}}",
            {% else -%}
                "{{ observationEntry.statusCode.code | get_property: 'ValueSet/ObservationStatus' }}",
            {% endif -%}
        "category": [
            {
                "coding": [
                    {
                        "system": "http://terminology.hl7.org/ValueSet/v3-ActClassExposure",
                        "code": "EXPOS",
                    }
                ]
            }
        ],
        {% include 'Utils/EffectiveTime' effectiveTime: observationEntry.effectiveTime %}
        {% include 'Utils/ValueHelper' value: observationEntry.value %}
        "component": [
            {% assign agents = observationEntry.participant | to_array | where: "typeCode", "CSM" %}
            {% for agent in agents %}
                {
                    "code" : {
                        "coding" :
                        [
                            {
                                "system" : "http://terminology.hl7.org/CodeSystem/v3-ParticipationType",
                                "code" : "EXPAGNT",
                                "display" : "Exposure Agent"
                            }
                        ]
                    },
                    {% include 'Utils/ValueHelper' value: agent.participantRole.playingEntity.code %}
                },
            {% endfor %}
        ],
        "extension": [
            {% assign  locs = observationEntry.participant | to_array | where: "typeCode", "LOC" %}
            {% for loc in locs %}
                {
                    "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-address-extension",
                    "valueAddress": { {% include 'DataType/Address' Address: loc.participantRole.addr %} }
                },
            {% endfor %}
        ],
    },
    "request":{
        "method":"PUT",
        "url":"Observation/{{ ID }}",
    },
},
