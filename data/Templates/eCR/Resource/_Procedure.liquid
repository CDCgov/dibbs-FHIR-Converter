{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Procedure",
        "id":"{{ ID }}",
        "meta":
        {
            "profile":
            [
                "http://hl7.org/fhir/us/core/StructureDefinition/us-core-procedure",
            ],
        },
        "identifier":
        [
            { {% include 'DataType/Identifier' Identifier: procedureEntry.id -%} },
        ],
        "status":"{{ procedureEntry.statusCode.code }}",
        "code":
        {
            {% assign translations = procedureEntry.code.translation | to_array -%}
            {% assign code = procedureEntry.code | to_array -%}
            {% assign codes = code | concat: translations -%}
            {% include 'DataType/CodeableConcept' CodeableConcept: codes -%}
        },
        {% include 'Utils/EffectiveTime' effectiveTime: procedureEntry.effectiveTime, timeType: "performed" %}
        "bodySite":
        [
            { {% include 'DataType/CodeableConcept' CodeableConcept: procedureEntry.targetSiteCode -%} },
        ],
        {% assign rels = procedure.entryRelationship | to_array %}
        {% for rel in rels %}
            {% if rel.typeCode == "RSON" %}
                "reasonCode": 
                [
                    { {% include 'DataType/CodeableConcept' CodeableConcept: rel.observation.value -%} },
                ],
            {% elseif rel.typeCode == "COMP" and rel.observation.templateId.root == "2.16.840.1.113883.10.20.22.4.9" %}
                {% comment %} Reaction observation {% endcomment %}   
                "complication":
                [
                    { {% include 'DataType/CodeableConcept' CodeableConcept: rel.observation.value -%} },
                ]
            {% endif %}
        {% endfor %}
        
        "extension": [
            {% if procedureEntry.methodCode %}
                {
                    "url": "http://hl7.org/fhir/StructureDefinition/procedure-method",
                    "valueCodeableConcept": { {% include 'DataType/CodeableConcept' CodeableConcept: procedureEntry.methodCode %} }
                },
            {% endif %}

            {% if procedureEntry.priorityCode %}
                {
                    "url": "priorityCode",
                    "valueCodeableConcept": { {% include 'DataType/CodeableConcept' CodeableConcept: procedureEntry.priorityCode %} }
                },
            {% endif %}

            {% if procedureEntry.specimen %}
                {
                    "url": "specimen",
                    "valueCodeableConcept": { {% include 'DataType/CodeableConcept' CodeableConcept: procedureEntry.specimen.specimenRole.spcimenPlayingEntity.code -%} }
                }
            {% endif %}
        ]
    },
    "request":{
        "method":"PUT",
        "url":"Procedure/{{ ID }}",
    },
},
