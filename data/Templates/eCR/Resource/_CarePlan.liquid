{
    "fullUrl":"urn:uuid:{{ID}}",
    "resource":{
        "resourceType": "CarePlan",
        "id":"{{ID}}",
        "identifier":
        [
            {% assign ids = carePlan.id | to_array -%}
            {% for id in ids -%}
                { {% include 'DataType/Identifier' Identifier: id -%} }
            {% endfor -%}
        ],
        "status": "unknown",
        "intent": "proposal",
        "subject": {
            "reference": "{{ patientReference }}",
        },
        "activity":[
            {% for entry in carePlan.entry %}
                {% comment %} Other entry types are handles in `Entry/PlanOfTreatment/entry` {% endcomment %}
                {% if entry.act %}
                    {
                        "detail": {
                            {% if entry.act.moodCode == "ARQ" or entry.act.moodCode == "APT" %}
                                "kind": "Appointment",
                            {% else %}
                                "kind": "Task",
                            {% endif %}
                            "code": { {% include 'DataType/CodeableConcept' CodeableConcept: entry.act.code %} },
                            {% assign reasons = entr.act.entryRelationship | to_array | where: "typeCode", "RSON" %}
                            "reasonCode": [
                                {% for reason in reasons %}
                                    { {% include 'DataType/CodeableConcept' CodeableConcept: reason.observation.value %} },
                                {% endfor %}
                            ],
                            {% if entry.act.effectiveTime %}
                                "status": "scheduled",
                            {% else %}
                                "status": "not-started",
                            {% endif %}
                            {% comment %} planned activities use scheduledString instead of scheduledDateTime {% endcomment %}
                            {% capture time %}{% include 'Utils/EffectiveTime' effectiveTime: entry.act.effectiveTime, timeType: "scheduled" %}{% endcapture %}
                            {{ time |  replace_first: "DateTime", "String" }}
                        }
                    }
                {% endif %}
            {% endfor %}
        ]
    },
    "request":{
        "method":"PUT",
        "url":"CarePlan/{{ID}}",
    },
},
