{% assign components = obs.entryRelationship.organizer.component |  to_array %}
{% for component in components %}
    {% comment %} Determination of Reportability (required) {% endcomment %}
     {% if component.observation and component.observation.templateId.root == '2.16.840.1.113883.10.20.15.2.3.19' %}
        {% assign determinationOfReportabilityVal = component.observation.value %}
        {
            "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-determination-of-reportability-extension",
            "valueCodeableConcept":
            {
                {% include 'DataType/CodeableConcept' CodeableConcept: determinationOfReportabilityVal -%}
            },
        },
     {% endif %}
    
    {% assign entryRelationships = component.observation.entryRelationship | to_array %}
    {% for entry in entryRelationships %}
        {% if entry.observation.code.code == "RR3" and entry.observation.value %}
            {% comment %} Determination of Reportability Reportability Rule {% endcomment %}
            {
                "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-determination-of-reportability-rule-extension",
                {% assign determinationRRRule = entry.observation.value %}
                {% if determinationRRRule["xsi:type"] == "ST" %}
                    "valueString": "{{ determinationRRRule._ }}",
                {% elseif determinationRRRule["xsi:type"] == "CD" %}
                    "valueCodeableConcept":
                    {
                        {% include 'DataType/CodeableConcept' CodeableConcept: determinationRRRule -%}
                    },
                {% endif %}
            },
        {% elseif entry.observation.code.code == "RR2" and entry.observation.value %}
            {% comment %} Determination of Reportability Reportability Reason {% endcomment %}
            {
                "url": "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-determination-of-reportability-reason-extension",
                {% assign determinationRRReason = entry.observation.value %}
                {% if determinationRRReason["xsi:type"] == "ST" %}
                    "valueString": "{{ determinationRRReason._ }}",
                {% elseif determinationRRRule["xsi:type"] == "CD" %}
                    "valueCodeableConcept":
                    {
                        {% include 'DataType/CodeableConcept' CodeableConcept: determinationRRReason -%}
                    },
                {% endif %}
            },
        {% endif %}
    {% endfor %}
{% endfor %}