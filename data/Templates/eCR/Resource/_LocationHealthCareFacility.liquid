{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Location",
        "meta": {
            "profile": [
                "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-location"
            ]
        },
        "id":"{{ ID }}",
        "identifier":
        [
            {% assign ids = location.id | to_array -%}
            {% if ids != empty -%}
                {% for id in ids -%}
                    {% include 'DataType/Identifier' Identifier: id -%}
                {% endfor -%}
            {% else %}
                {
                    "system": "urn:ietf:rfc:3986",
                    "value": "urn:uuid:{{ ID }}"
                }
            {% endif %}
        ],

        {% if location.location.name and location.location.name._ -%}
            "name":"{{ location.location.name._ }}",
        {% elsif location.serviceProviderOrganization and location.serviceProviderOrganization.name and location.serviceProviderOrganization.name._ -%}
            "name":"{{ location.serviceProviderOrganization.name._ }}",
        {% else %}
            "_name": {
                "extension": [
                    {%- include 'Extension/DataAbsentReason' nullFlavor: "unknown" -%}
                ],
            },
        {% endif %}

        {% if location.location.addr and location.location.addr.state._ -%}
            "address": {
                {% include 'DataType/Address' Address: location.location.addr -%}
            },
        {% elsif location.serviceProviderOrganization.addr and location.serviceProviderOrganization.addr.state._ -%}
            "address": {
                {% include 'DataType/Address' Address: location.serviceProviderOrganization.addr -%}
            },
        {% else %}
            "address": {
                "_city": {
                    "extension": [
                        {%- include 'Extension/DataAbsentReason' nullFlavor: "unknown" -%}
                    ],
                },
                "_state": {
                    "extension": [
                        {%- include 'Extension/DataAbsentReason' nullFlavor: "unknown" -%}
                    ],
                }
            },
        {% endif -%}

        "telecom":
        [
            {% assign telecoms = location.location.telecom | to_array -%}
            {% if telecoms.first.value -%}
            {% else -%}
                {% assign telecoms = location.serviceProviderOrganization.telecom | to_array -%}
            {% endif -%}
            {% for telecom in telecoms -%}
            { {% include 'DataType/ContactPoint' ContactPoint: telecom -%} },
            {% endfor -%}
        ],

        "type":
            [
                {% assign codes = location.code | to_array -%}
                {% for code in codes -%}
                { {% include 'DataType/CodeableConcept' CodeableConcept: code, minCardinality: 1 -%} },
                {% endfor -%}
            ],
    },
},
