{
{%- assign oid_pattern = "^([0-2])((\.0)|(\.[1-9][0-9]*))*$" -%}
{%- assign uuid_pattern = "^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$" -%}
{%- assign oid_pattern_match = Identifier.root | match: oid_pattern | size -%}
{%- assign uuid_pattern_match = Identifier.root | match: uuid_pattern | size -%}
{%- capture system -%}
  {{- Identifier.root | get_code_system_uri -}}
{%- endcapture %}
{%- if Identifier.nullFlavor == null -%}
    {%- if Identifier.extension -%}
        "system": "{{- system | prepend_id -}}",
        "value": "{{- Identifier.extension | remove_prefix: system -}}",
    {%- elsif Identifier.root -%}
        {%- if oid_pattern_match == 1 or uuid_pattern_match == 1 -%}
            {%- if Identifier.root == system -%}
                {% comment %} if system did not change it is not a recognized system with a URI {% endcomment %}
                "system": "urn:ietf:rfc:3986",
                "value": "{{Identifier.root | prepend_id -}}",
            {%- else -%}
                {% comment %} if system changed it is a recognized system with a URI, but missing an extension, so we need to use the data absent reason extension. {% endcomment %}
                "system": "{{- system -}}",
                "_value": {
                    "extension": [
                        {%- include 'Extension/DataAbsentReason' nullFlavor: "unknown" -%}
                    ],
                },
            {%- endif -%}
        {%- else -%}
        {% comment %} This is means the root is an invalid UID as it is neither an UUID or OID. In this case we will just set it as the value. {% endcomment %}
            "value": "{{- Identifier.root -}}",
        {%- endif -%}
    {%- endif -%}
{%- elsif Identifier.root -%}
    "system": "{{- system | prepend_id -}}",
    "_value": {
        "extension": [
            {%- include 'Extension/DataAbsentReason' nullFlavor: Identifier.nullFlavor -%}
        ],
    },
{%- else -%}
    "extension": [
        {%- include 'Extension/DataAbsentReason' nullFlavor: Identifier.nullFlavor -%}
    ],
{%- endif -%}
{%- if Identifier.assigningAuthorityName != null -%}
    "assigner": {
        "display": "{{- Identifier.assigningAuthorityName -}}",
    }
{%- endif -%}
},