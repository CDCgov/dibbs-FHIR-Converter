{
    "fullUrl":"urn:uuid:{{ ID }}",
    "resource":{
        "resourceType": "Location",
        "meta": {
            "profile": [
                "http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-location"
            ]
        },
        "id":"{{ ID }}",
        "identifier":
        [
            {% assign ids = location.id | to_array -%}
            {% if ids != empty -%}
                {% for id in ids -%}
                    {% include 'DataType/Identifier' Identifier: id -%}
                {% endfor -%}
            {% else %}
                {
                    "system": "urn:ietf:rfc:3986",
                    "value": "urn:uuid:{{ ID }}"
                }
            {% endif %}
        ],

        {% if location.location.name and location.location.name._ -%}
            "name":"{{ location.location.name._ }}",
        {% elsif location.serviceProviderOrganization and location.serviceProviderOrganization.name and location.serviceProviderOrganization.name._ -%}
            "name":"{{ location.serviceProviderOrganization.name._ }}",
        {% else %}
            "_name": {
                "extension": [
                    {% assign nfName = location.location.name.nullFlavor | default: location.serviceProviderOrganization.name.nullFlavor | default: "unknown" %}
                    {%- include 'Extension/DataAbsentReason' nullFlavor: nfName | get_property: 'ValueSet/NullFlavor' -%}
                ],
            },
        {% endif %}

        "address": {
            {% if location.location %}
                {% assign addressLocation = location.location %}
            {% elsif location.serviceProviderOrganization %}
                {% assign addressLocation = location.serviceProviderOrganization %}
            {% else %}
                {% assign addressLocation = null %}
            {% endif %}
            {% if addressLocation.addr -%}
                {% include 'DataType/Address' Address: addressLocation.addr -%}
            {% endif %}
            {% if addressLocation.addr.city._ == null %}
                "_city": {
                    "extension": [
                        {%- assign nfCity = addressLocation.addr.city.nullFlavor | default: addressLocation.addr.nullFlavor | default: "unknown" -%}
                        {%- include 'Extension/DataAbsentReason' nullFlavor: nfCity | get_property: 'ValueSet/NullFlavor' -%}
                    ]
                },
            {% endif %}
            {% if addressLocation.addr.state._ == null %}
                "_state": {
                    "extension": [
                        {%- assign nfState = addressLocation.addr.state.nullFlavor | default: addressLocation.addr.nullFlavor | default: "unknown" -%}
                        {%- include 'Extension/DataAbsentReason' nullFlavor: nfState | get_property: 'ValueSet/NullFlavor' -%}
                    ]
                },
            {% endif %}
        },

        "telecom":
        [
            {% assign telecoms = location.location.telecom | to_array -%}
            {% if telecoms.first.value -%}
            {% else -%}
                {% assign telecoms = location.serviceProviderOrganization.telecom | to_array -%}
            {% endif -%}
            {% for telecom in telecoms -%}
            { {% include 'DataType/ContactPoint' ContactPoint: telecom -%} },
            {% endfor -%}
        ],

        "type":
            [
                {% assign codes = location.code | to_array -%}
                {% for code in codes -%}
                { {% include 'DataType/CodeableConcept' CodeableConcept: code, minCardinality: 1, nullFlavor: code.nullFlavor -%} },
                {% endfor -%}
            ],
    },
},
